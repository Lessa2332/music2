<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ –û—Ä–∫–µ—Å—Ç—Ä –¥–ª—è –†–ê–°-–¥–∏—Ç–∏–Ω–∏</title>
    
    <!-- MediaPipe –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Comic Sans MS', sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #4a148c 100%);
            color: white;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            touch-action: none;
        }
        
        #cameraContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #cameraView {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            opacity: 0.3;
        }
        
        #canvas3d {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        .ui-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .title {
            background: rgba(255, 64, 129, 0.9);
            padding: 15px 25px;
            border-radius: 50px;
            text-align: center;
            font-size: 24px;
            border: 3px solid white;
            box-shadow: 0 5px 20px rgba(255, 64, 129, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .status-panel {
            background: rgba(33, 150, 243, 0.9);
            padding: 15px 25px;
            border-radius: 30px;
            border: 3px solid white;
            backdrop-filter: blur(10px);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 20px;
        }
        
        .instrument-panel {
            position: fixed;
            bottom: 120px;
            left: 20px;
            right: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            z-index: 1000;
        }
        
        .instrument-btn {
            background: rgba(255, 193, 7, 0.9);
            border: 3px solid white;
            color: #1a237e;
            padding: 15px 10px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .instrument-btn:hover {
            transform: translateY(-5px);
        }
        
        .instrument-btn.active {
            background: #4CAF50;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 25px #4CAF50;
        }
        
        .control-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 1000;
        }
        
        .control-btn {
            background: rgba(76, 175, 80, 0.9);
            border: 2px solid white;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            min-width: 140px;
        }
        
        .finger-guide {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 3;
            opacity: 0.5;
            animation: pulse 2s infinite;
            pointer-events: none;
        }
        
        .finger-counter {
            position: fixed;
            bottom: 200px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 40px;
            color: #FFEB3B;
            text-shadow: 0 0 20px #FF9800;
            z-index: 1000;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a237e;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            text-align: center;
        }
        
        .loading-dots {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .dot {
            width: 20px;
            height: 20px;
            background: #4CAF50;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }
        
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.7; }
        }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        .debug-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: #4CAF50;
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            font-family: monospace;
            z-index: 1000;
            display: none;
        }
        
        .combo-display {
            position: fixed;
            top: 120px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 24px;
            color: #FF4081;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 20px;
            margin: 0 20px;
        }
        
        @media (max-width: 768px) {
            .title { font-size: 18px; padding: 12px 20px; }
            .status-panel { font-size: 16px; padding: 12px 20px; }
            .instrument-btn { font-size: 14px; padding: 12px 8px; }
            .control-btn { font-size: 14px; padding: 10px 15px; min-width: 120px; }
            .finger-counter { font-size: 30px; bottom: 180px; }
        }
        
        @media (max-height: 700px) {
            .instrument-panel { bottom: 100px; }
            .finger-counter { bottom: 170px; }
        }
    </style>
</head>
<body>
    <!-- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø -->
    <div class="loading" id="loadingScreen">
        <div>
            <div style="font-size: 60px;">üëãüéµ</div>
            <h1 style="color: #FFEB3B; margin: 20px 0;">–û—Ä–∫–µ—Å—Ç—Ä –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É –º–æ—Ç–æ—Ä–∏–∫–∏</h1>
            <div style="font-size: 18px; margin-bottom: 20px;">–ü–æ–∫–∞–∂–∏ –ø–∞–ª—å—á–∏–∫–∏ –∫–∞–º–µ—Ä—ñ!</div>
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <!-- –Ü–ù–¢–ï–†–§–ï–ô–° -->
    <div class="ui-panel">
        <div class="title">üéµ –¢–ï–†–ê–ü–ï–í–¢–ò–ß–ù–ò–ô –û–†–ö–ï–°–¢–† –î–õ–Ø –†–û–ó–í–ò–¢–ö–£ –ú–û–¢–û–†–ò–ö–ò üéµ</div>
        <div class="status-panel" id="statusPanel">
            –ü–æ–∫–∞–∂–∏ –¥–æ–ª–æ–Ω—é –∫–∞–º–µ—Ä—ñ –¥–ª—è –ø–æ—á–∞—Ç–∫—É...
        </div>
    </div>
    
    <div class="combo-display" id="comboDisplay">
        –ö–æ–º–±—ñ–Ω–∞—Ü—ñ—ó: <span id="comboCount">0</span>
    </div>
    
    <div class="finger-guide" id="fingerGuide">üëã</div>
    
    <div class="finger-counter" id="fingerCounter">
        –ü–∞–ª—å—Ü—ñ–≤: <span id="fingerCount">0</span>
    </div>

    <div class="instrument-panel">
        <button class="instrument-btn active" onclick="switchInstrument('piano')">üéπ –ú–µ–ª–æ–¥—ñ—è</button>
        <button class="instrument-btn" onclick="switchInstrument('drums')">ü•Å –†–∏—Ç–º</button>
        <button class="instrument-btn" onclick="switchInstrument('bells')">üîî –î–∑–≤—ñ–Ω</button>
        <button class="instrument-btn" onclick="switchInstrument('animals')">üê∂ –ó–≤—ñ—Ä—ñ</button>
        <button class="instrument-btn" onclick="switchInstrument('nature')">üåä –ü—Ä–∏—Ä–æ–¥–∞</button>
        <button class="instrument-btn" onclick="switchInstrument('synth')">üåü –°–∏–Ω—Ç</button>
    </div>

    <div class="control-panel">
        <button class="control-btn" onclick="toggleCamera()">üì∑ –ö–∞–º–µ—Ä–∞</button>
        <button class="control-btn" onclick="toggleMute()">üîä –ó–≤—É–∫</button>
        <button class="control-btn" onclick="showInstructions()">‚ùì –î–æ–ø–æ–º–æ–≥–∞</button>
    </div>

    <!-- –î–õ–Ø –ù–ê–õ–ê–ì–û–î–ñ–ï–ù–ù–Ø -->
    <div class="debug-info" id="debugInfo"></div>

    <!-- –ö–ê–ú–ï–†–ê –¢–ê 3D -->
    <div id="cameraContainer">
        <video id="cameraView" autoplay playsinline muted></video>
    </div>
    <canvas id="canvas3d"></canvas>

    <script>
        // ========== –ö–û–ù–°–¢–ê–ù–¢–ò –î–õ–Ø –†–ê–° ==========
        const CONFIG = {
            VOLUME: 0.3,
            FINGER_THRESHOLD: 0.05,
            COMBO_TIME: 2000,
            GESTURE_HOLD_TIME: 1000,
            SMOOTHING: 0.7
        };

        // ========== –°–ò–°–¢–ï–ú–ù–Ü –ó–ú–Ü–ù–ù–Ü ==========
        let scene, camera, renderer;
        let hands;
        let currentInstrument = 'piano';
        let isMuted = false;
        let isCameraOn = true;
        let comboCount = 0;
        let lastComboTime = 0;
        
        // –¢—Ä–µ–∫—ñ–Ω–≥ —Å—Ç–∞–Ω—É
        let handState = {
            raisedFingers: [],
            lastFingers: [],
            gestureStart: 0,
            currentGesture: null
        };
        
        // –ê—É–¥—ñ–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
        let audioContext;
        let instruments = {};
        let visualObjects = [];
        
        // DOM –µ–ª–µ–º–µ–Ω—Ç–∏
        const elements = {
            loading: document.getElementById('loadingScreen'),
            statusPanel: document.getElementById('statusPanel'),
            fingerGuide: document.getElementById('fingerGuide'),
            fingerCounter: document.getElementById('fingerCounter'),
            fingerCount: document.getElementById('fingerCount'),
            comboDisplay: document.getElementById('comboDisplay'),
            comboCount: document.getElementById('comboCount'),
            debugInfo: document.getElementById('debugInfo'),
            cameraView: document.getElementById('cameraView'),
            canvas3d: document.getElementById('canvas3d'),
            cameraContainer: document.getElementById('cameraContainer')
        };

        // ========== –ö–û–ú–ë–Ü–ù–ê–¶–Ü–á –ü–ê–õ–¨–¶–Ü–í ==========
        const FINGER_COMBOS = {
            // –ü—Ä–æ—Å—Ç—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó (1-2 –ø–∞–ª—å—Ü—ñ)
            'thumb': { notes: ['C3'], name: '–í–µ–ª–∏–∫–∏–π', color: 0xFF4081 },
            'index': { notes: ['D3'], name: '–í–∫–∞–∑—ñ–≤–Ω–∏–π', color: 0x4CAF50 },
            'middle': { notes: ['E3'], name: '–°–µ—Ä–µ–¥–Ω—ñ–π', color: 0x2196F3 },
            'ring': { notes: ['F3'], name: '–ë–µ–∑—ñ–º–µ–Ω–Ω–∏–π', color: 0xFFEB3B },
            'pinky': { notes: ['G3'], name: '–ú—ñ–∑–∏–Ω–µ—Ü—å', color: 0x9C27B0 },
            
            // –î–≤–æ-–ø–∞–ª—å—Ü–µ–≤—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó
            'thumb+index': { notes: ['C3', 'D3'], name: 'OK üëå', color: 0xFF9800 },
            'index+middle': { notes: ['D3', 'E3'], name: '–ú–∏—Ä ‚úåÔ∏è', color: 0x00BCD4 },
            'middle+ring': { notes: ['E3', 'F3'], name: '–†–æ–≥–∞ ü§ò', color: 0xE91E63 },
            'all': { notes: ['C3', 'D3', 'E3', 'F3', 'G3'], name: '–í—Å—ñ –ø–∞–ª—å—Ü—ñ üñêÔ∏è', color: 0x8BC34A }
        };

        // ========== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ==========
        async function init() {
            try {
                // –°–ø–æ—á–∞—Ç–∫—É –∞—É–¥—ñ–æ (—á–µ–∫–∞—î–º–æ –∫–ª—ñ–∫—É)
                await initAudio();
                
                // –ü–æ—Ç—ñ–º –≥—Ä–∞—Ñ—ñ–∫–∞
                initThreeJS();
                
                // –Ü —Ç—Ä–µ–∫—ñ–Ω–≥ —Ä—É–∫
                await initHandTracking();
                
                // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
                showWelcomeMessage();
                
            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:", error);
                showError("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É", "–°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–∞–º–µ—Ä—É.");
            }
        }

        // ========== –ê–£–î–Ü–û –°–ò–°–¢–ï–ú–ê ==========
        async function initAudio() {
            return new Promise((resolve) => {
                const startAudio = async () => {
                    try {
                        // –°—Ç–≤–æ—Ä—é—î–º–æ AudioContext –ø—ñ—Å–ª—è –∫–ª—ñ–∫—É
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        
                        // –ß–µ–∫–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ
                        if (audioContext.state === 'suspended') {
                            await audioContext.resume();
                        }
                        
                        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ Tone.js
                        await Tone.start();
                        Tone.setContext(audioContext);
                        
                        // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
                        createInstruments();
                        
                        console.log("–ê—É–¥—ñ–æ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞");
                        updateStatus("–¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –µ–∫—Ä–∞–Ω—É –¥–ª—è –∑–≤—É–∫—É üëÜ");
                        resolve();
                        
                    } catch (error) {
                        console.warn("–ê—É–¥—ñ–æ –ø–æ–º–∏–ª–∫–∞:", error);
                        // –í—Å–µ –æ–¥–Ω–æ –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –±–µ–∑ –∑–≤—É–∫—É
                        resolve();
                    }
                };
                
                // –°—Ç–∞—Ä—Ç –ø–æ –∫–ª—ñ–∫—É –∞–±–æ —Ç–æ—Ä–∫–∞–Ω–Ω—é
                document.addEventListener('click', startAudio, { once: true });
                document.addEventListener('touchstart', startAudio, { once: true });
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –ø—ñ–¥–∫–∞–∑–∫—É
                updateStatus("üëÜ –¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –µ–∫—Ä–∞–Ω—É –¥–ª—è —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –∑–≤—É–∫—É");
            });
        }

        function createInstruments() {
            // –ú–µ—Ä–µ–∂–µ–≤–∏–π –≤–∏—Ö—ñ–¥
            const masterGain = new Tone.Gain(CONFIG.VOLUME).toDestination();
            
            // 1. –§–æ—Ä—Ç–µ–ø—ñ–∞–Ω–æ (—Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä)
            instruments.piano = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "sine" },
                envelope: {
                    attack: 0.01,
                    decay: 0.1,
                    sustain: 0.3,
                    release: 0.5
                }
            }).connect(masterGain);
            
            // 2. –ë–∞—Ä–∞–±–∞–Ω–∏ (—à—É–º–æ–≤–∏–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä)
            instruments.drums = new Tone.NoiseSynth({
                noise: { type: "white" },
                envelope: {
                    attack: 0.001,
                    decay: 0.1,
                    sustain: 0
                }
            }).connect(masterGain);
            
            // 3. –î–∑–≤—ñ–Ω–æ—á–∫–∏ (FM —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä)
            instruments.bells = new Tone.PolySynth(Tone.FMSynth, {
                harmonicity: 8,
                modulationIndex: 2,
                oscillator: { type: "sine" },
                envelope: {
                    attack: 0.01,
                    decay: 0.2,
                    sustain: 0.2,
                    release: 1.5
                }
            }).connect(masterGain);
            
            // 4. –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä (–¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤)
            instruments.synth = new Tone.PolySynth(Tone.AMSynth).connect(masterGain);
            
            // 5. –ñ–∏–≤–æ—Ç–Ω—ñ (—Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∑–≤—É–∫–∏)
            instruments.animals = new Tone.MembraneSynth().connect(masterGain);
            
            // 6. –ü—Ä–∏—Ä–æ–¥–∞ (–ø–ª–∞–≤–Ω—ñ –∑–≤—É–∫–∏)
            instruments.nature = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "sine" },
                envelope: {
                    attack: 0.5,
                    decay: 0.5,
                    sustain: 0.3,
                    release: 2
                }
            }).connect(masterGain);
        }

        // ========== THREE.JS –°–¶–ï–ù–ê ==========
        function initThreeJS() {
            // –°—Ü–µ–Ω–∞
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x1a237e, 1, 10);
            
            // –ö–∞–º–µ—Ä–∞
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.z = 5;
            
            // –†–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ 
                canvas: elements.canvas3d, 
                alpha: true, 
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            // –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–æ–Ω –∑ —á–∞—Å—Ç–∏–Ω–æ–∫
            createBackgroundParticles();
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è
            animate();
        }

        function createBackgroundParticles() {
            const particleCount = 200;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 20;
                positions[i + 1] = (Math.random() - 0.5) * 20;
                positions[i + 2] = (Math.random() - 0.5) * 20;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.1,
                color: 0x4CAF50,
                transparent: true,
                opacity: 0.5
            });
            
            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            visualObjects.push(particles);
        }

        // ========== MEDIAPIPE –¢–†–ï–ö–Ü–ù–ì ==========
        async function initHandTracking() {
            updateStatus("–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç—Ä–µ–∫—ñ–Ω–≥ —Ä—É–∫...");
            
            try {
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MediaPipe Hands
                hands = new Hands({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                    }
                });
                
                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                hands.setOptions({
                    maxNumHands: 2,
                    modelComplexity: 0, // –ù–∏–∂—á–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                
                // –û–±—Ä–æ–±–Ω–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                hands.onResults(onHandResults);
                
                // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä–∏
                await startCamera();
                
                updateStatus("–ü–æ–∫–∞–∂–∏ –¥–æ–ª–æ–Ω—é –∫–∞–º–µ—Ä—ñ üñêÔ∏è");
                
            } catch (error) {
                console.warn("–ü–æ–º–∏–ª–∫–∞ —Ç—Ä–µ–∫—ñ–Ω–≥—É:", error);
                updateStatus("–¢—Ä–µ–∫—ñ–Ω–≥ –Ω–µ –ø—Ä–∞—Ü—é—î. –¢–æ—Ä–∫–∞–π—Ç–µ—Å—è –µ–∫—Ä–∞–Ω—É üëá");
                enableTouchMode();
            }
        }

        async function startCamera() {
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error("–ö–∞–º–µ—Ä–∞ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è");
                }
                
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: "user",
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });
                
                elements.cameraView.srcObject = stream;
                
                // –¶–∏–∫–ª –æ–±—Ä–æ–±–∫–∏ –∫–∞–¥—Ä—ñ–≤
                async function processFrame() {
                    try {
                        if (elements.cameraView.readyState >= 2) {
                            await hands.send({ image: elements.cameraView });
                        }
                    } catch (e) {
                        console.warn("–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∫–∞–¥—Ä—É:", e);
                    }
                    requestAnimationFrame(processFrame);
                }
                
                elements.cameraView.onloadeddata = processFrame;
                
            } catch (error) {
                console.warn("–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏:", error);
                updateStatus("–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –¢–æ—Ä–∫–∞–π—Ç–µ—Å—è –µ–∫—Ä–∞–Ω—É üëá");
                enableTouchMode();
            }
        }

        function enableTouchMode() {
            isCameraOn = false;
            elements.cameraContainer.style.display = 'none';
            updateStatus("–¢–æ—Ä–∫–∞–π—Ç–µ—Å—è –µ–∫—Ä–∞–Ω—É –ø–∞–ª—å—Ü—è–º–∏ üëá");
            
            // –î–æ–¥–∞—î–º–æ touch –ø–æ–¥—ñ—ó
            document.addEventListener('touchstart', handleTouch);
            document.addEventListener('mousedown', handleTouch);
        }

        // ========== –û–ë–†–û–ë–ö–ê –†–£–ö ==========
        function onHandResults(results) {
            if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
                // –†—É–∫–∏ –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ
                elements.fingerGuide.textContent = "üëã";
                elements.fingerGuide.style.opacity = "0.3";
                updateStatus("–ü–æ–∫–∞–∂–∏ –¥–æ–ª–æ–Ω—é –∫–∞–º–µ—Ä—ñ üñêÔ∏è");
                handState.raisedFingers = [];
                updateFingerCounter();
                return;
            }
            
            // –û–±—Ä–æ–±–ª—è—î–º–æ –ø–µ—Ä—à—É —Ä—É–∫—É
            const landmarks = results.multiHandLandmarks[0];
            const raisedFingers = detectRaisedFingers(landmarks);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω
            handState.raisedFingers = raisedFingers;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateFingerCounter();
            updateFingerGuide(raisedFingers);
            checkForCombos(raisedFingers);
            createVisualEffects(landmarks, raisedFingers);
            
            // –í—ñ–¥—Ç–≤–æ—Ä—é—î–º–æ –∑–≤—É–∫–∏
            playSoundsForFingers(raisedFingers);
        }

        function detectRaisedFingers(landmarks) {
            const raised = [];
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø—ñ–¥–Ω—è—Ç—ñ –ø–∞–ª—å—Ü—ñ
            const fingerData = [
                { tip: 4, base: 2, name: 'thumb' },
                { tip: 8, base: 5, name: 'index' },
                { tip: 12, base: 9, name: 'middle' },
                { tip: 16, base: 13, name: 'ring' },
                { tip: 20, base: 17, name: 'pinky' }
            ];
            
            fingerData.forEach((finger, index) => {
                const tip = landmarks[finger.tip];
                const base = landmarks[finger.base];
                
                // –ü–∞–ª–µ—Ü—å –≤–≤–∞–∂–∞—î—Ç—å—Å—è –ø—ñ–¥–Ω—è—Ç–∏–º, —è–∫—â–æ –∫—ñ–Ω—á–∏–∫ –∑–Ω–∞—á–Ω–æ –≤–∏—â–µ –æ—Å–Ω–æ–≤–∏
                if (tip.y < base.y - CONFIG.FINGER_THRESHOLD) {
                    raised.push({
                        index: index,
                        name: finger.name,
                        position: tip
                    });
                }
            });
            
            return raised;
        }

        function checkForCombos(raisedFingers) {
            if (raisedFingers.length === 0) return;
            
            const now = Date.now();
            const fingerNames = raisedFingers.map(f => f.name).sort();
            const comboKey = fingerNames.join('+');
            
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é
            const combo = FINGER_COMBOS[comboKey] || FINGER_COMBOS[raisedFingers[0].name];
            
            if (combo && now - lastComboTime > CONFIG.COMBO_TIME) {
                lastComboTime = now;
                comboCount++;
                elements.comboCount.textContent = comboCount;
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –Ω–∞–∑–≤—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó
                updateStatus(`–ö–æ–º–±—ñ–Ω–∞—Ü—ñ—è: ${combo.name}`);
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –æ—Å–æ–±–ª–∏–≤–∏–π –µ—Ñ–µ–∫—Ç –¥–ª—è –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó
                createComboEffect(combo.color);
            }
        }

        // ========== –í–Ü–î–¢–í–û–†–ï–ù–ù–Ø –ó–í–£–ö–Ü–í ==========
        function playSoundsForFingers(fingers) {
            if (isMuted || !instruments[currentInstrument]) return;
            
            const now = Tone.now();
            
            fingers.forEach((finger, index) => {
                // –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–∞–ª—å—Ü—è
                const time = now + (index * 0.05);
                
                switch(currentInstrument) {
                    case 'piano':
                        playPianoNote(finger.index, time);
                        break;
                    case 'drums':
                        playDrumSound(finger.index, time);
                        break;
                    case 'bells':
                        playBellSound(finger.index, time);
                        break;
                    case 'animals':
                        playAnimalSound(finger.index, time);
                        break;
                    case 'nature':
                        playNatureSound(finger.index, time);
                        break;
                    case 'synth':
                        playSynthSound(finger.index, time);
                        break;
                }
            });
        }

        function playPianoNote(fingerIndex, time) {
            const notes = ['C3', 'D3', 'E3', 'F3', 'G3'];
            const note = notes[fingerIndex % notes.length];
            instruments.piano.triggerAttackRelease(note, '8n', time);
        }

        function playDrumSound(fingerIndex, time) {
            const drumTypes = [
                { note: 'C1', duration: '8n' },  // –ë–∞—Å
                { note: 'D1', duration: '16n' }, // –ú–∞–ª–µ–Ω—å–∫–∏–π
                { note: 'E1', duration: '32n' }, // –•–∞–π-—Ö–µ—Ç
                { note: 'F1', duration: '8n' },  // –¢–æ–º
                { note: 'G1', duration: '16n' }  // –ö–ª–∞–ø
            ];
            
            const drum = drumTypes[fingerIndex % drumTypes.length];
            instruments.drums.triggerAttackRelease(drum.duration, time);
        }

        function playBellSound(fingerIndex, time) {
            const notes = ['C5', 'E5', 'G5', 'A5', 'C6'];
            const note = notes[fingerIndex % notes.length];
            instruments.bells.triggerAttackRelease(note, '2n', time);
        }

        function playAnimalSound(fingerIndex, time) {
            const sounds = [
                { note: 'C2', duration: '4n' }, // –õ–µ–≤
                { note: 'D2', duration: '8n' }, // –°–æ–±–∞–∫–∞
                { note: 'E2', duration: '16n' }, // –ö—ñ—à–∫–∞
                { note: 'F2', duration: '4n' }, // –ö–æ—Ä–æ–≤–∞
                { note: 'G2', duration: '8n' }  // –ü—ñ–≤–µ–Ω—å
            ];
            
            const sound = sounds[fingerIndex % sounds.length];
            instruments.animals.triggerAttackRelease(sound.note, sound.duration, time);
        }

        function playNatureSound(fingerIndex, time) {
            const sounds = [
                { note: 'C4', duration: '1n' }, // –î–æ—â
                { note: 'E4', duration: '2n' }, // –í—ñ—Ç–µ—Ä
                { note: 'G4', duration: '4n' }, // –í–æ–¥–∞
                { note: 'A4', duration: '2n' }, // –ü—Ç–∞—Ö–∏
                { note: 'C5', duration: '1n' }  // –ì—Ä–æ–º
            ];
            
            const sound = sounds[fingerIndex % sounds.length];
            instruments.nature.triggerAttackRelease(sound.note, sound.duration, time);
        }

        function playSynthSound(fingerIndex, time) {
            const notes = ['C4', 'E4', 'G4', 'B4', 'D5'];
            const note = notes[fingerIndex % notes.length];
            instruments.synth.triggerAttackRelease(note, '8n', time);
        }

        // ========== –í–Ü–ó–£–ê–õ–¨–ù–Ü –ï–§–ï–ö–¢–ò ==========
        function createVisualEffects(landmarks, raisedFingers) {
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–æ—á–∫–∏ –Ω–∞ –º—ñ—Å—Ü—è—Ö –ø–∞–ª—å—Ü—ñ–≤
            raisedFingers.forEach(finger => {
                const x = (finger.position.x * 2 - 1) * 5;
                const y = -(finger.position.y * 2 - 1) * 3;
                
                createFingerPoint(x, y, finger.index);
            });
            
            // –ú–∞–ª—é—î–º–æ –ª—ñ–Ω—ñ—ó –º—ñ–∂ –ø–∞–ª—å—Ü—è–º–∏
            if (raisedFingers.length > 1) {
                for (let i = 0; i < raisedFingers.length - 1; i++) {
                    const f1 = raisedFingers[i];
                    const f2 = raisedFingers[i + 1];
                    
                    const x1 = (f1.position.x * 2 - 1) * 5;
                    const y1 = -(f1.position.y * 2 - 1) * 3;
                    const x2 = (f2.position.x * 2 - 1) * 5;
                    const y2 = -(f2.position.y * 2 - 1) * 3;
                    
                    createConnectionLine(x1, y1, x2, y2, i);
                }
            }
        }

        function createFingerPoint(x, y, fingerIndex) {
            const colors = [0xFF4081, 0x4CAF50, 0x2196F3, 0xFFEB3B, 0x9C27B0];
            const color = colors[fingerIndex % colors.length];
            
            const geometry = new THREE.SphereGeometry(0.1, 16, 16);
            const material = new THREE.MeshBasicMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.8
            });
            
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.set(x, y, -2);
            scene.add(sphere);
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è
            gsap.to(sphere.scale, {
                x: 2,
                y: 2,
                z: 2,
                duration: 0.3,
                ease: "back.out(1.7)"
            });
            
            gsap.to(sphere.material, {
                opacity: 0,
                duration: 0.5,
                onComplete: () => scene.remove(sphere)
            });
        }

        function createConnectionLine(x1, y1, x2, y2, index) {
            const colors = [0xFF9800, 0x00BCD4, 0xE91E63, 0x8BC34A];
            const color = colors[index % colors.length];
            
            const material = new THREE.LineBasicMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.6,
                linewidth: 2
            });
            
            const points = [
                new THREE.Vector3(x1, y1, -2),
                new THREE.Vector3(x2, y2, -2)
            ];
            
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const line = new THREE.Line(geometry, material);
            scene.add(line);
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è
            gsap.to(line.material, {
                opacity: 0,
                duration: 0.5,
                onComplete: () => scene.remove(line)
            });
        }

        function createComboEffect(color) {
            // –°—Ç–≤–æ—Ä—é—î–º–æ –∫—ñ–ª—å—Ü–µ –¥–ª—è –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó
            const ringGeometry = new THREE.RingGeometry(0.5, 0.7, 64);
            const ringMaterial = new THREE.MeshBasicMaterial({
                color: color,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });
            
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.position.z = -1;
            ring.rotation.x = Math.PI / 2;
            scene.add(ring);
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è
            gsap.to(ring.scale, {
                x: 3,
                y: 3,
                duration: 0.8,
                ease: "power2.out"
            });
            
            gsap.to(ring.material, {
                opacity: 0,
                duration: 0.8,
                onComplete: () => scene.remove(ring)
            });
        }

        // ========== –¢–û–†–ö–ê–ù–ù–Ø –ï–ö–†–ê–ù–£ ==========
        function handleTouch(event) {
            event.preventDefault();
            
            const x = event.clientX || event.touches[0].clientX;
            const y = event.clientY || event.touches[0].clientY;
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ, —è–∫–∏–π "–ø–∞–ª–µ—Ü—å" —Ç–æ—Ä–∫–Ω—É–≤—Å—è (5 –∑–æ–Ω)
            const sectionWidth = window.innerWidth / 5;
            const fingerIndex = Math.min(4, Math.floor(x / sectionWidth));
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —à—Ç—É—á–Ω—ñ –ø–∞–ª—å—Ü—ñ
            const fakeFingers = [{
                index: fingerIndex,
                name: ['thumb', 'index', 'middle', 'ring', 'pinky'][fingerIndex],
                position: { x: x / window.innerWidth, y: y / window.innerHeight }
            }];
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            handState.raisedFingers = fakeFingers;
            updateFingerCounter();
            updateFingerGuide(fakeFingers);
            
            // –í—ñ–¥—Ç–≤–æ—Ä—é—î–º–æ –∑–≤—É–∫
            playSoundsForFingers(fakeFingers);
            
            // –í—ñ–∑—É–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç
            createTouchEffect(x, y, fingerIndex);
        }

        function createTouchEffect(x, y, fingerIndex) {
            const xPos = (x / window.innerWidth) * 10 - 5;
            const yPos = -(y / window.innerHeight) * 6 + 3;
            
            createFingerPoint(xPos, yPos, fingerIndex);
        }

        // ========== –Ü–ù–¢–ï–†–§–ï–ô–° ==========
        function updateStatus(message) {
            elements.statusPanel.textContent = message;
        }

        function updateFingerCounter() {
            const count = handState.raisedFingers.length;
            elements.fingerCount.textContent = count;
            
            // –ó–º—ñ–Ω—é—î–º–æ –∫–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ
            if (count === 0) {
                elements.fingerCounter.style.color = '#FF4081';
            } else if (count <= 2) {
                elements.fingerCounter.style.color = '#4CAF50';
            } else if (count <= 4) {
                elements.fingerCounter.style.color = '#2196F3';
            } else {
                elements.fingerCounter.style.color = '#FFEB3B';
            }
        }

        function updateFingerGuide(fingers) {
            if (fingers.length === 0) {
                elements.fingerGuide.textContent = "üëã";
                elements.fingerGuide.style.opacity = "0.3";
            } else if (fingers.length === 1) {
                elements.fingerGuide.textContent = "üëÜ";
                elements.fingerGuide.style.opacity = "1";
            } else if (fingers.length === 2) {
                elements.fingerGuide.textContent = "‚úåÔ∏è";
                elements.fingerGuide.style.opacity = "1";
            } else if (fingers.length === 3) {
                elements.fingerGuide.textContent = "ü§ü";
                elements.fingerGuide.style.opacity = "1";
            } else if (fingers.length === 4) {
                elements.fingerGuide.textContent = "üññ";
                elements.fingerGuide.style.opacity = "1";
            } else {
                elements.fingerGuide.textContent = "üñêÔ∏è";
                elements.fingerGuide.style.opacity = "1";
            }
        }

        // ========== –ö–ï–†–£–í–ê–ù–ù–Ø ==========
        function switchInstrument(instrument) {
            currentInstrument = instrument;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.instrument-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(getInstrumentName(instrument))) {
                    btn.classList.add('active');
                }
            });
            
            updateStatus(`–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${getInstrumentName(instrument)}`);
            
            // –í—ñ–¥—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤–∏–π –∑–≤—É–∫
            if (!isMuted && instruments[instrument]) {
                setTimeout(() => {
                    playTestSound();
                }, 100);
            }
        }

        function getInstrumentName(instrument) {
            const names = {
                'piano': '–ú–µ–ª–æ–¥—ñ—è',
                'drums': '–†–∏—Ç–º',
                'bells': '–î–∑–≤—ñ–Ω',
                'animals': '–ó–≤—ñ—Ä—ñ',
                'nature': '–ü—Ä–∏—Ä–æ–¥–∞',
                'synth': '–°–∏–Ω—Ç'
            };
            return names[instrument];
        }

        function playTestSound() {
            const now = Tone.now();
            
            switch(currentInstrument) {
                case 'piano':
                    instruments.piano.triggerAttackRelease('C4', '8n', now);
                    break;
                case 'drums':
                    instruments.drums.triggerAttackRelease('8n', now);
                    break;
                case 'bells':
                    instruments.bells.triggerAttackRelease('C5', '4n', now);
                    break;
            }
        }

        function toggleCamera() {
            isCameraOn = !isCameraOn;
            elements.cameraContainer.style.display = isCameraOn ? 'block' : 'none';
            
            if (isCameraOn) {
                updateStatus("–ü–æ–∫–∞–∂–∏ –ø–∞–ª—å—á–∏–∫–∏ –∫–∞–º–µ—Ä—ñ üñêÔ∏è");
            } else {
                updateStatus("–¢–æ—Ä–∫–∞–π—Ç–µ—Å—è –µ–∫—Ä–∞–Ω—É üëá");
            }
        }

        function toggleMute() {
            isMuted = !isMuted;
            
            if (isMuted) {
                Tone.Destination.mute = true;
                updateStatus("üîá –ó–≤—É–∫ –≤–∏–º–∫–Ω–µ–Ω–æ");
            } else {
                Tone.Destination.mute = false;
                updateStatus("üîä –ó–≤—É–∫ —É–≤—ñ–º–∫–Ω–µ–Ω–æ");
            }
        }

        function showInstructions() {
            alert(
                "üéµ –¢–ï–†–ê–ü–ï–í–¢–ò–ß–ù–ò–ô –û–†–ö–ï–°–¢–† –î–õ–Ø –†–û–ó–í–ò–¢–ö–£ –ú–û–¢–û–†–ò–ö–ò üéµ\n\n" +
                "üéØ –ú–ï–¢–ê: –†–æ–∑–≤–∏—Ç–æ–∫ –¥—Ä—ñ–±–Ω–æ—ó –º–æ—Ç–æ—Ä–∏–∫–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—ó —Ä—É–∫ —Ç–∞ —Å–ª—É—Ö–æ–≤–æ–≥–æ —Å–ø—Ä–∏–π–Ω—è—Ç—Ç—è\n\n" +
                "üëÜ –Ø–ö –ì–†–ê–¢–ò:\n" +
                "1. –ü–æ–∫–∞–∂—ñ—Ç—å –ø–∞–ª—å—á–∏–∫–∏ –∫–∞–º–µ—Ä—ñ\n" +
                "2. –ö–æ–∂–µ–Ω –ø–∞–ª–µ—Ü—å - —Å–≤—ñ–π –∑–≤—É–∫\n" +
                "3. –†—ñ–∑–Ω—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó - —Ä—ñ–∑–Ω—ñ –º–µ–ª–æ–¥—ñ—ó\n" +
                "4. –ö—É–ª–∞–∫ - –ø–∞—É–∑–∞\n" +
                "5. –î–æ–ª–æ–Ω—è - —É—Å—ñ –∑–≤—É–∫–∏\n\n" +
                "üéπ –Ü–ù–°–¢–†–£–ú–ï–ù–¢–ò:\n" +
                "‚Ä¢ –ú–µ–ª–æ–¥—ñ—è - –º—É–∑–∏—á–Ω—ñ –Ω–æ—Ç–∏\n" +
                "‚Ä¢ –†–∏—Ç–º - –±–∞—Ä–∞–±–∞–Ω–Ω—ñ –∑–≤—É–∫–∏\n" +
                "‚Ä¢ –î–∑–≤—ñ–Ω - –¥–∑–≤—ñ–Ω–æ—á–∫–∏\n" +
                "‚Ä¢ –ó–≤—ñ—Ä—ñ - –∑–≤—É–∫–∏ —Ç–≤–∞—Ä–∏–Ω\n" +
                "‚Ä¢ –ü—Ä–∏—Ä–æ–¥–∞ - –ø—Ä–∏—Ä–æ–¥–Ω—ñ –∑–≤—É–∫–∏\n" +
                "‚Ä¢ –°–∏–Ω—Ç - –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ñ –∑–≤—É–∫–∏\n\n" +
                "üîÑ –†–ï–ñ–ò–ú–ò:\n" +
                "‚Ä¢ –ö–∞–º–µ—Ä–∞ - —Ç—Ä–µ–∫—ñ–Ω–≥ —Ä—É–∫\n" +
                "‚Ä¢ –¢–æ—Ä–∫–∞–Ω–Ω—è - –≥—Ä–∞ –ø–æ –µ–∫—Ä–∞–Ω—É\n" +
                "‚Ä¢ –ó–≤—É–∫ - —É–≤—ñ–º–∫/–≤–∏–º–∫\n\n" +
                "üåü –î–õ–Ø –†–ê–°-–î–Ü–¢–ï–ô:\n" +
                "‚Ä¢ –°—Ç–∏–º—É–ª—è—Ü—ñ—è —Å–µ–Ω—Å–æ—Ä–Ω–æ—ó —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó\n" +
                "‚Ä¢ –†–æ–∑–≤–∏—Ç–æ–∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—ó —Ä—É–∫-–æ–∫–æ\n" \\
                "‚Ä¢ –ü–æ–∑–∏—Ç–∏–≤–Ω–µ –ø—ñ–¥–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –∑–≤—É–∫–∞–º–∏\n" +
                "‚Ä¢ –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –º–æ—Ç–∏–≤–∞—Ü—ñ—è –¥–æ —Ä—É—Ö—ñ–≤"
            );
        }

        function showWelcomeMessage() {
            // –°—Ö–æ–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            elements.loading.style.opacity = '0';
            setTimeout(() => {
                elements.loading.style.display = 'none';
            }, 500);
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è
            updateStatus("–í—ñ—Ç–∞—î–º–æ! –ü–æ–∫–∞–∂—ñ—Ç—å –¥–æ–ª–æ–Ω—é –∫–∞–º–µ—Ä—ñ üñêÔ∏è");
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–∞–ª—å—Ü—ñ–≤
            const guides = ["üëã", "üëÜ", "‚úåÔ∏è", "ü§ü", "üññ", "üñêÔ∏è"];
            let i = 0;
            const interval = setInterval(() => {
                elements.fingerGuide.textContent = guides[i];
                i = (i + 1) % guides.length;
            }, 500);
            
            setTimeout(() => clearInterval(interval), 3000);
        }

        function showError(title, message) {
            updateStatus(`‚ö†Ô∏è ${title}: ${message}`);
        }

        // ========== –ê–ù–Ü–ú–ê–¶–Ü–Ø ==========
        function animate() {
            requestAnimationFrame(animate);
            
            // –û–±–µ—Ä—Ç–∞—î–º–æ —á–∞—Å—Ç–∏–Ω–∫–∏ —Ñ–æ–Ω—É
            visualObjects.forEach(obj => {
                if (obj.rotation) {
                    obj.rotation.x += 0.001;
                    obj.rotation.y += 0.002;
                }
            });
            
            renderer.render(scene, camera);
        }

        // ========== –ó–ê–ü–£–°–ö ==========
        window.addEventListener('load', init);
        
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        // –ï–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü—ñ–π
        window.switchInstrument = switchInstrument;
        window.toggleCamera = toggleCamera;
        window.toggleMute = toggleMute;
        window.showInstructions = showInstructions;
    </script>
</body>
</html>
